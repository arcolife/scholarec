1
benchmark and tune the milc code on cluster and supercomput
arxivheplat0112038v1 19 dec 2001
steven gottlieba
b
a
depart of physicssw117 indiana univers bloomington in 47405 usa
b
theori group ms106 fermilab po box 500 batavia il 605100500 usa
recent we have benchmark and tune the milc code on a number of architectur includ intel itanium
and pentium iv piv dualcpu athlon and the latest compaq alpha node result will be present for
mani of these and we shall discuss some simpl code chang that can result in a veri dramat speedup of the
ks conjug gradient on processor with more advanc memori system such as piv ibm sp and alpha
1 introduct
2 architectur
thi contribut is a condens of a 16 page
poster with 17 tabl of benchmark the poster
is avail on the web 1
benchmark present here are for the conjug gradient algorithm with kogutsusskind
quark not just for d
they are done within the
context of a complet applic for creation of
gaug field use the ralgorithm 2 the applic use evenodd checkerboard which
reduc possibl reus of data in cach even
the singl cpu benchmark are done with a fulli
parallel applic that split the comput
within d
into two stage to accommod the
need to wait for boundari valu that would come
from anoth node in a multicpu run thi also
reduc potenti cach reusag on some of the
architectur we make use of assembl code for
basic su 3 arithmet routin or for prefetch
data to cach we use kogutsusskind quark for
benchmark becaus they are use in our dynam quark calcul ks quark are more
demand than wilson quark in term of memori bandwidth in singl precis the former
requir 145 bytesflop of input data and produc
036 byteflop of output for wilson quark onli
091 bytesflop of input is requir and output is
unchang thu it should not be surpris to
find that a wilson quark code can achiev higher
speed than report here 3
sinc august 2000 milc ha been work
with intel and ncsa under a nondisclosur
agreement to tune our code for the itanium processor in decemb 2000 we were allow to report first result without assembl code4 some
limit result with assembl code were report
at linux world last januari we may now talk
more freeli about result on itanium
milc ha had sever month of product
run on the initi terascal comput system
at the pittsburgh supercomput center it is
base on compaq es40 node that contain 667
mhz ev67 alpha chip the full 6 tf comput
will be base on 1000 mhz ev68 chip at the
end of march we were given access to the first
es45 node at psc that contain that chip
ibm sp test have been run on either the indiana univers sp or blue horizon at sdsc
they have 375 mhz power 3 chip deploy on
4way and 8way smp node respect
dure the spring we had access to a 15 ghz
pentium iv system and a dual 12 ghz athlon
system thank to ncsa and penguin comput respect
at
fermilab until june 15 2002
3 code chang
the work on the itanium processor wa carri
out in conjunct with two intel engin gautham doshi and brian nickerson doshi work
on inlin and optim compil flag for the
2
c code nickerson wrote assembl code that includ prefetch and loop over site the
chang describ next have not yet been tri
on itanium
the milc code data structur is site major
ie there is a structur for each site that contain
all the physic variabl for that site the lattic
is an array of site structur ad variabl to
the applic is quit easi one onli need to
modifi the site structur and when the lattic is
alloc the new variabl will be global access thi spring we test perform enhanc from temporari alloc of field
major variabl for the conjug gradient routin on chip with wider cach line thi result
in substanti speedup the gaug field and
necessari vector are copi to temporari variabl that are much better local in memori
if a cach line contain data not need for the
current site it is most like the data requir
for the next site to be comput rather than a
differ physic variabl as would be found in
the next byte of the site structur i suggest
these chang to dick foster of compaq who
implement them and improv prefetch
we achiev 464 mf the field major code ha not
yet been tri on itanium
42 alpha
in tabl 1 we compar the perform of
the old site major code with the new field major code we present result for both the 667
mhz ev67 chip in the es40 and the 1000 mhz
ev68 chip in the es45 we can see substanti
speedup both from the newer processor and the
code improv current itanium is the perform leader for smaller l while alpha lead
for larg l of cours the code are differ and
consider work would be requir to combin
both the benefit of assembl code with loop control and field major organ on each chip
43 power 3
the ibm sp realli benefit from the new field
major code tabl 2 show the perform and
speedup for variou l the substanti falloff
with increas l ha been greatli amelior
and the overal perform level ha increas
substanti even for small l these result
and the correspond multinod result were obtain on the indiana univers sp now let
turn to the commod processor
4 singl node result
the benchmark present here were run on
lattic of size l4 they are all for singl precis
gaug link and vector with dot product accumul in doubl precis the fermion matrix
is either for the kogutsusskind ks or fatlink
plu naik fatnaik action 5 for product
run we are use the asqtad action 6 the
perform of the invert is independ of the
detail of the fatten
41 itanium
result on itanium without assembl code were
present at ccp2000 4 and are avail on
the web with an 800 mhz processor perform wa 916 867 and 732 mf for l 4 6 and
8 respect becaus of memori access issu
perform drop to 326 mf for l 14 with
nickerson assembl code the number are quit
impress we have 1223 1139 and 938 mf for
l 4 6 and 8 respect and even for l 14
tabl 1
megaflop rate on alpha processor
l
es40
es45
es45
site major site major field major
6
517
731
977
8
495
701
843
10
395
548
934
12
249
395
778
14
253
347
609
tabl 2
megaflop rate and speedup on ibm sp
l site major field major speedup
4
512
663
129
6
458
705
154
8
391
682
174
10
215
557
258
12
158
528
335
14
135
449
332
3
tabl 3
megaflop rate and speedup on 15 ghz piv
l site major field major speedup
4
591
577
098
6
240
503
210
8
220
481
219
10
208
491
236
12
205
480
234
14
202
469
233
tabl 4
megaflop rate per cpu on dual 12 ghz athlon
mp system
l site m site m field m field m
singl
dual
singl
dual
4
590
464
654
457
6
203
167
336
251
8
176
142
298
232
10
170
134
289
228
12
165
132
287
239
14
166
133
281
218
44 intel ia32 and amd
both pentium iv and amd athlon mp processor show excel speedup on the new field
major code detail appear in tabl 3 and 4
for the athlon we had a dual cpu system and
show result for both one and two processor the
pentium iv is perform at almost 500 mf even
for l 8 and greater it is not as fast as the
previou chip discuss but it is certainli veri
cost effect the athlon system ha ddr memori rather than rambu rdram one can see
that for l 4 for which the problem fit in cach
the athlon despit it slower clock speed out
perform the penium iv howev for larger l
access to memori becom crucial and the pentium iv excel it would be interest to tri a
pentium iv motherboard that use ddr memori on the dual athlon system the fatnaik
invert wa benchmark and found to be 1020
mf faster than ks 1
5 multinod result
the program netpip ha been use to compar messag pass speed of fast ethernet
tabl 5
megaflop rate for 84 site
1
es45 field
839
es40 site
495
sp site
375
sp field
624
itanium site
503
platinum site
139
platinum field 159
scali field
72
per cpu
4
128
621
425 302
340 204
529 176
304
94
75
107 71
63
256
262
181
140
myrinet scali quadric and the ibm sp network fast ethernet onli achiev 2060 mbit
for messag of the size need dure the conjug gradient 80030k byte the other network except for quadric are about a factor of
10 faster quadric is about an addit factor
of two faster
tabl of result are avail 1 for es45 with
up to four cpu the es40 with up to 256 cpu
the ibm sp with up to 256 cpu the prototyp
itanium cluster with up to 16 cpu the platinum pentium iii cluster with up to 128 cpu
and a pentium ii cluster with scali interconnect
here we just display result for l 8 the tabl
indic whether the code wa site major or field
major scali is limit by the power of the cpu
result on larger number of es45 and itanium
node should be avail in late octob
thank to compaq intel ncsa penguin
comput psc sdsc uit and the milc
collabor
refer
1 s gottlieb httpphysicsindianaedusg
lattice01
2 s gottlieb et al phi rev d 35 1987
2531
3 m l
uscher these proceed heplat0110007
4 s gottlieb httpphysicsindianaedusg
ccp2000 comp phi comm to appear
heplat0112026
5 s naik nucl phi b316 1989 238
6 k orgino d toussaint and rl sugar
4
phi rev d 60 1999 054503 heplat9903032 gp lepag ibid 59 1999
074502 heplat9809157
